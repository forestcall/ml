---
import PageLayout from "@layouts/PageLayout.astro";
import Gallery from "@components/Gallery.astro";

interface Image {
  imgUrl: string;
  alt: string;
}

const imageFiles: string[] = [
  "AFRICA_Coffee_.JPG",
  "Balsamic_Roasted_Carrots_2_.jpg",
  "Balsamic_Salad_.jpg",
  "Berries_and_cream_2_ip2_.jpg",
  "berries_stitched__2.jpg",
  "Broccoli_Romanesco_and_radishes_.jpg",
  "Chloes_Chocolate.jpg",
  "Chloes_Mango_.jpg",
  "Chloes_Pineapple_.jpg",
  "Chloes_Raspberry_.jpg",
  "Chloes_Raspberry.jpg",
  "Chloes_Tangerine_.jpg",
  "Chocolate_.jpg",
  "Colored_pasta_.jpg",
  "food_16_.jpg",
  "food_22_.jpg",
  "food_32_.jpg",
  "food_33_.jpg",
  "food_35_.jpg",
  "food_37_.jpg",
  "food_38_.jpg",
  "food_43_.jpg",
  "food_45_.jpg",
  "food_47_.jpg",
  "food_48_.jpg",
  "food_49_.jpg",
  "food_51_.jpg",
  "food_54_.jpg",
  "Food_55_.jpg",
  "food_57_.jpg",
  "food_58_.jpg",
  "food_59_.jpg",
  "food_60_.jpg",
  "food_61_.jpg",
  "food_62_.jpg",
  "food_63_.jpg",
  "food_64_.jpg",
  "food_65_.jpg",
  "food_66_.jpg",
  "food_67_.jpg",
  "food_71_.jpg",
  "food_left_.jpg",
  "Global_Knife_Bread_.jpg",
  "Global_Knife_TOMATO_.jpg",
  "Global_Knife_w_Sweet_Potato_.jpg",
  "Heirloom_Tomato_1_.jpg",
  "Heirloom_tomatoes_Heart_.jpg",
  "Heirloom_Tomoato_cu_.jpg",
  "ITALY_Spaghetti_.jpg",
  "K-Candy_.jpg",
  "K-Tomatoes_.jpg",
  "Maries_HEART__final_.jpg",
  "New_Port_image_4_.jpg",
  "P_bolthouse_.jpg",
  "P_breville_espresso_.jpg",
  "P_breville_juicer_.jpg",
  "P_cooktop_.jpg",
  "P_ice_tray_.jpg",
  "P_jitb_lettuce_.jpg",
  "P_maries_.jpg",
  "P_maries_sink_.jpg",
  "P_pasta_.jpg",
  "P_pear_.jpg",
  "P_sandwich_.jpg",
  "P_toast_.jpg",
  "P_tomatoes_.jpg",
  "page_10_.jpg",
  "page_11_.jpg",
  "pub_burger_.jpg",
  "spagetti_1B_.jpg",
  "Steak_2a.jpg",
  "strawberries_2a_.jpg",
  "sunlit_eggs_.jpg",
  "Vitamix_berry_v2_.jpg",
  "Vitamix_pea_soup.jpg",
  "Vitamix_Salsa_v2_.jpg",
  "Vitamix_tomato.jpg"
];

const images: Image[] = imageFiles.map(file => ({
  imgUrl: `/images/photos/food/${file}`,
  alt: file.replace(/\.(jpg|jpeg|png|gif)$/i, '')
           .replace(/[_-]/g, ' ')
           .replace(/\s+/g, ' ')
           .trim()
}));

---

<PageLayout title="Food" description="A gallery of food photographs">
  <div class="w-full max-w-screen-xl mx-auto px-4 mt-[60px]">
    <Gallery images={images} />
  </div>
</PageLayout>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const images = document.querySelectorAll('.gallery-image');
    images.forEach((img, index) => {
      if (img instanceof HTMLImageElement) {
        img.addEventListener('error', function() {
          console.error(`Failed to load image ${index + 1}: ${this.src}`);
          // Instead of hiding the image, let's show an error placeholder
          this.src = 'data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%22100%22%20height%3D%22100%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Crect%20width%3D%22100%22%20height%3D%22100%22%20fill%3D%22%23eee%22%2F%3E%3Ctext%20x%3D%2250%25%22%20y%3D%2250%25%22%20dominant-baseline%3D%22middle%22%20text-anchor%3D%22middle%22%20font-size%3D%2214%22%20fill%3D%22%23aaa%22%3EError%3C%2Ftext%3E%3C%2Fsvg%3E';
          this.alt = 'Error loading image';
        });
        img.addEventListener('load', function() {
          console.log(`Successfully loaded image ${index + 1}: ${this.src}`);
        });
      }
    });
  });

  // Function to check if images are loading correctly
  function checkImages() {
    const images = document.querySelectorAll('.gallery-image');
    images.forEach((img, index) => {
      if (img instanceof HTMLImageElement) {
        fetch(img.src)
          .then(response => {
            if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.blob();
          })
          .then(() => console.log(`Image ${index + 1} is accessible`))
          .catch(e => console.error(`Error with image ${index + 1}: ${e.message}`));
      }
    });
  }

  // Run the check after a short delay to ensure all images have been processed
  setTimeout(checkImages, 2000);
</script>
